DELIMITER $$
create trigger vms_qa_trgr_vri_update BEFORE UPDATE ON vms_rules_info
for each row
BEGIN
IF (OLD.RULE <> NEW.RULE OR OLD.DESCRIPTION <> NEW.DESCRIPTION)
THEN
INSERT INTO vms_rules_info_history(RULE, NAME, DESCRIPTION, CREATED_BY, ACTION_GID)
SELECT NEW.RULE, NEW.NAME, NEW.DESCRIPTION, NEW.MODIFIED_BY, A.GID FROM vms_action_info A WHERE LOWER(A.ACTION) = 'update';
SET NEW.MODIFIED_AT = NOW();
ELSE
BEGIN
SET NEW.MODIFIED_BY = OLD.MODIFIED_BY;
SET NEW.MODIFIED_AT = OLD.MODIFIED_AT;
END;
END IF;
END $$

DELIMITER ;